version: 2.1
jobs:
  # build:
  #   docker:
  #     - image: circleci/node:12.14.0
  #   steps:
  #     - checkout

  #     - restore_cache:
  #         name: Restore Yarn Package Cache
  #         keys:
  #           - yarn-packages-{{ checksum "yarn.lock" }}
  #     - run:
  #         name: Install Dependencies
  #         command: yarn install
  #     - save_cache:
  #         name: Save Yarn Package Cache
  #         key: yarn-packages-{{ checksum "yarn.lock" }}
  #         paths:
  #           - ~/.cache/yarn
  #     - run:
  #         name: Build Public
  #         command: npm run deploy

  deploy:
    docker:
      - image: circleci/node:12.14.0

    steps:
      - checkout
      - add_ssh_keys
      - run:
          name: Keyscan Github (HACK)
          command: ssh-keyscan -H github.com >> ~/.ssh/known_hosts

      - run:
          name: Deploy to dokku
          command: |
            git remote add dokku dokku@178.128.86.161:revhere-api
            git push dokku master

workflows:
  version: 2
  deploy:
    jobs:
      # - build
      - deploy:
          filters:
            branches:
              only:
                - master
          # requires:
          #   - build
