version: 2.1
jobs:
  # build:
  #   docker:
  #     - image: circleci/node:12.14.0
  #   steps:
  #     - checkout

  #     - restore_cache:
  #         name: Restore Yarn Package Cache
  #         keys:
  #           - yarn-packages-{{ checksum "yarn.lock" }}
  #     - run:
  #         name: Install Dependencies
  #         command: yarn install
  #     - save_cache:
  #         name: Save Yarn Package Cache
  #         key: yarn-packages-{{ checksum "yarn.lock" }}
  #         paths:
  #           - ~/.cache/yarn
  #     - run:
  #         name: Build Public
  #         command: npm run deploy

  deploy:
    docker:
      - image: circleci/node:12.14.0

    steps:
      - checkout
      - add_ssh_keys
      - run:
          name: Deploy to dokku
          command: |
            ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no root@$DROPLET_IP
            git remote add production dokku@$DROPLET_IP:$APP_NAME
            git push production master

workflows:
  version: 2
  deploy:
    jobs:
      # - build
      - deploy:
          filters:
            branches:
              only:
                - master
          # requires:
          #   - build
