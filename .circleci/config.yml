version: 2.1
jobs:
  # build:
  #   docker:
  #     - image: circleci/node:12.14.0
  #   steps:
  #     - checkout

  #     - restore_cache:
  #         name: Restore Yarn Package Cache
  #         keys:
  #           - yarn-packages-{{ checksum "yarn.lock" }}
  #     - run:
  #         name: Install Dependencies
  #         command: yarn install
  #     - save_cache:
  #         name: Save Yarn Package Cache
  #         key: yarn-packages-{{ checksum "yarn.lock" }}
  #         paths:
  #           - ~/.cache/yarn
  #     - run:
  #         name: Build Public
  #         command: npm run deploy

  deploy:
    docker:
      - image: circleci/node:12.14.0

    steps:
      - checkout
      - add_ssh_keys:
          fingerprints:
            - "fc:ba:c1:2f:f4:44:ab:06:74:28:8f:51:3a:bf:e6:51"

      - run: ssh-keyscan $DROPLET_IP >> ~/.ssh/known_hosts

      - run:
        name: Deploy to dokku
          command: |
            git remote add production dokku@$DROPLET_IP:$APP_NAME
            git push production master

workflows:
  version: 2
  deploy:
    jobs:
      # - build
      - deploy:
          filters:
            branches:
              only:
                - master
          # requires:
          #   - build
